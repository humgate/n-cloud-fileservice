## Резюме
Репозиторий содержит выполнение дипломного проекта "Облачное хранилище” по курсу "Java разработчик" в netology.ru.
## Постановка задачи
Разработать приложение - REST-сервис. Сервис должен предоставить REST интерфейс для возможности загрузки файлов и 
вывода списка уже загруженных файлов пользователя. Все запросы к сервису должны быть авторизованы. Заранее 
подготовленное веб-приложение (FRONT) должно подключаться к разработанному сервису без доработок, а также использовать 
функционал FRONT для авторизации, загрузки и вывода списка файлов пользователя.

Детальные требования к заданию изложены [здесь](https://github.com/netology-code/jd-homeworks/blob/master/diploma/cloudservice.md)
## Описание архитектуры решения

Приложение построено по стандартной трех-слойной схеме, включающей три слоя:
- <b>Контроллеры.</b> Обеспечивают взаимодействие с пользователем или внешним API по протоколу HTTP. Они экспонируют
необходимый набор [энд-поинтов](https://github.com/humgate/n-cloud-fileservice/blob/master/src/main/resources/CloudServiceSpecification.yaml),
обеспечивают извлечение данных из поступающих запросов, формирование ответов на запросы, включая и ответы на запросы в
случае возникновения ошибок. Реализация указанных функций в классах пакетов controller и exceptionhandlers.
- <b>Сервисы</b>. Реализуют логику обработки данных, полученных от контроллеров. Реализация в классах пакета service.
- <b>Репозиторий</b>. Выполняет операции взаимодействия с базой данных, такие как извлечение и сохранение данных в БД. 
Реализация в интерфейсах Spring data JPA в пакете repository.<br><br>
Отдельным блоком выделены компоненты, выполняющие аутентификацию и авторизацию входящих запросов (security). В приложении
реализована аутентификация и авторизация с помощью jwt токенов. Все энд-поинты приложения требуют аутентификации за 
исключением /login, который доступен всем. Обратившись к /login пользователь получает в ответ jwt токен, который ему
необходимо прилагать в заголовке каждого запроса (кроме /login).<br>
Поскольку jwt токен является "самодостаточным" для
аутентификации и авторизации пользователя и никак не связан с сессией пользователя, дополнительно реализован механизм
учета токенов пользователей, выполнивших logout - черный список токенов. При выполнении logout, токен обратившегося
пользователя помещается в черный список. При аутентификации пользователя, специальный фильтр в security chain проверяет 
токен, в том числе на наличие его в черном списке и запрещает дальнейшие операции, если токен присутствует в черном
списке. Сам черный список реализован на базе библиотеки net.jodah.expiringmap, которая позволяет удобно реализовать
сохранение токенов в черном списке и автоматическое удаление токена из списка при наступлении момента времени, когда токен
прекращает свое действие. Для выполнения операций с токенами использована библиотека io.jsonwebtoken. Реализация классов
обеспечивающих security приложения находится в пакете security, настройка в config/WebSecurityConfig.<br><br>
Для хранения данных использована база данных PostgreSQL. Структура базы данных создается с помощью liquibase. 
Миграционные скрипты liquibase написаны так, чтобы можно было использовать любую реляционную базу данных. В случае,
если liquibase определяет наличие PostgreSQL, то он создает специфичные для этой БД некоторые типы данных (bytea для 
хранения файлов), а также некоторые специфичные constraints (проверка формата e-mail).<br>
Создание и администрирование пользователей приложения находится за рамками настоящего проекта. Три учетных записи
пользователей создаются в БД при старте приложения, если их там еще нет (пакет init). 


